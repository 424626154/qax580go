var CityData=function(){function t(){}var e=(__define,t);return p=e.prototype,t}();egret.registerClass(CityData,"CityData");var CitySprite=function(t){function e(){t.call(this),this.isonclik=!1,this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){this.graphics.beginFill(0),this.graphics.drawRoundRect(0,0,GameData.cityspritew,GameData.cityspriteh,10,10),this.graphics.endFill(),this.graphics.beginFill(16777215),this.graphics.drawRoundRect(1,1,GameData.cityspritew-2,GameData.cityspriteh-2,10,10),this.graphics.endFill(),this.citytext=new egret.TextField,this.citytext.textAlign=egret.HorizontalAlign.CENTER,this.citytext.verticalAlign=egret.VerticalAlign.MIDDLE,this.citytext.fontFamily="Arial",this.citytext.textColor=0,this.citytext.size=24,this.citytext.width=GameData.cityspritew,this.citytext.height=GameData.cityspriteh,this.citytext.bold=!0,this.addChild(this.citytext),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this)},p.setPost=function(t,e,i,h){this.pos_x=e,this.pos_y=e,this.city=i,this.x=t*GameData.cityspritew,this.y=e*GameData.cityspriteh,this.width=GameData.cityspritew,this.height=GameData.cityspriteh,this.citytext.text=i.name,this.movebg=h},p.touch=function(t){if(t.type==egret.TouchEvent.TOUCH_TAP){if(this.isonclik||2!=MoveBg.gameState)return;this.isonclik=!0,this.img=new egret.Bitmap,this.img.texture=RES.getRes(this.city.isselect?"ok":"x"),this.img.x=(this.width-this.img.width)/2,this.img.y=(this.height-this.img.height)/2,this.img.scaleX=.2,this.img.scaleY=.2,this.addChild(this.img);var e=egret.Tween.get(this.img);if(e.to({scaleX:1.5,scaleY:1.5},500),e.call(this.tweenComplete,this),1==this.city.isselect){this.citytext.textColor=7833753;var i=RES.getRes("s_ok");i.play(0,1),GameData.setScore(GameData.getScore()+1),GameBg.setScore(),GameData.getScore()==GameData.mycitynum&&this.movebg.endGame()}else{this.citytext.textColor=14423100;var i=RES.getRes("s_x");i.play(0,1),GameData.setTime(GameData.getTime()-1),GameBg.setTime(),0==GameData.getTime()&&this.movebg.endGame()}this.citytext.text=this.city.name}},p.tweenComplete=function(){this.img.parent.removeChild(this.img)},e}(egret.Sprite);egret.registerClass(CitySprite,"CitySprite");var GameBg=function(t){function e(){t.call(this),this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){var t=new egret.Shape;t.graphics.beginFill(16777215),t.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),t.graphics.endFill(),this.addChild(t);var i=new egret.TextField;i.x=40,i.y=20,i.text="时间:",i.textColor=0,this.addChild(i),e.time=new egret.TextField,e.time.x=120,e.time.y=20,e.time.text=GameData.getTime()+"",e.time.textColor=0,this.addChild(e.time);var h=new egret.TextField;h.x=280,h.y=20,h.text="乡镇数:",h.textColor=0,this.addChild(h),e.score=new egret.TextField,e.score.x=390,e.score.y=20,e.score.text=GameData.getScore()+"/"+GameData.mycitynum,e.score.textColor=0,this.addChild(e.score);var s=new MoveBg;this.addChild(s)},e.setScore=function(){e.score.text=GameData.getScore()+"/"+GameData.mycitynum},e.setTime=function(){e.time.text=GameData.getTime()+""},e}(egret.Sprite);egret.registerClass(GameBg,"GameBg");var GameData=function(){function t(){this.otherCity=new Array,this.myCity=new Array,this.allCity=new Array,this.initData()}var e=(__define,t);return p=e.prototype,p.initData=function(){this.myCity.push("庆安镇"),this.myCity.push("民乐镇"),this.myCity.push("大罗镇"),this.myCity.push("平安镇"),this.myCity.push("勤劳镇"),this.myCity.push("久胜镇"),this.myCity.push("建民乡"),this.myCity.push("巨宝山乡"),this.myCity.push("新胜乡"),this.myCity.push("丰收乡"),this.myCity.push("发展乡"),this.myCity.push("同乐乡"),this.myCity.push("致富乡"),this.myCity.push("欢胜乡"),this.myCity.push("柳河林校"),this.myCity.push("柳河农场"),this.otherCity.push("宝山镇"),this.otherCity.push("绥胜镇"),this.otherCity.push("西长发镇"),this.otherCity.push("永安镇"),this.otherCity.push("太平川镇"),this.otherCity.push("秦家镇"),this.otherCity.push("双河镇"),this.otherCity.push("三河镇"),this.otherCity.push("四方台镇"),this.otherCity.push("津河镇"),this.otherCity.push("张维镇"),this.otherCity.push("东津镇"),this.otherCity.push("红旗乡"),this.otherCity.push("连岗乡"),this.otherCity.push("新华乡"),this.otherCity.push("兴福乡"),this.otherCity.push("东富乡"),this.otherCity.push("三井乡"),this.otherCity.push("五营乡"),this.otherCity.push("兴和乡"),this.otherCity.push("望奎镇"),this.otherCity.push("通江镇"),this.otherCity.push("卫星镇"),this.otherCity.push("海丰镇"),this.otherCity.push("莲花镇"),this.otherCity.push("先锋镇"),this.otherCity.push("东郊乡"),this.otherCity.push("后三乡"),this.otherCity.push("火箭乡"),this.otherCity.push("灯塔乡"),this.otherCity.push("东升乡"),this.otherCity.push("恭六乡"),this.otherCity.push("白四林场"),this.otherCity.push("种畜场"),this.otherCity.push("兰西镇"),this.otherCity.push("榆林镇"),this.otherCity.push("临江镇"),this.otherCity.push("平山镇"),this.otherCity.push("康荣乡"),this.otherCity.push("燎原乡"),this.otherCity.push("北安乡"),this.otherCity.push("长江乡"),this.otherCity.push("兰河乡"),this.otherCity.push("红星乡"),this.otherCity.push("红光乡"),this.otherCity.push("长岗乡"),this.otherCity.push("远大乡"),this.otherCity.push("星火乡"),this.otherCity.push("奋斗乡"),this.otherCity.push("青冈镇"),this.otherCity.push("中和镇"),this.otherCity.push("祯祥镇"),this.otherCity.push("兴华镇"),this.otherCity.push("永丰镇"),this.otherCity.push("芦河镇"),this.otherCity.push("劳动乡"),this.otherCity.push("建设乡"),this.otherCity.push("新村乡"),this.otherCity.push("昌盛乡"),this.otherCity.push("柞岗乡"),this.otherCity.push("民政乡"),this.otherCity.push("德胜乡"),this.otherCity.push("迎春乡"),this.otherCity.push("连丰乡"),this.otherCity.push("明水镇"),this.otherCity.push("兴仁镇"),this.otherCity.push("永兴镇"),this.otherCity.push("崇德镇"),this.otherCity.push("通达镇"),this.otherCity.push("双兴乡"),this.otherCity.push("树人乡"),this.otherCity.push("光荣乡"),this.otherCity.push("繁荣乡"),this.otherCity.push("通泉乡"),this.otherCity.push("育林乡"),this.otherCity.push("绥棱镇"),this.otherCity.push("上集镇"),this.otherCity.push("靠山乡"),this.otherCity.push("后头乡"),this.otherCity.push("太平庄镇"),this.otherCity.push("吉兴岗镇"),this.otherCity.push("火石山乡"),this.otherCity.push("卧里屯乡"),this.otherCity.push("青肯泡乡"),this.otherCity.push("先源乡");for(var e=0;e<this.myCity.length;e++){var i=new CityData;i.name=this.myCity[e],i.isselect=!0,this.allCity.push(i)}for(var h=t.row*t.colu-this.myCity.length,e=0;h>e;e++){var i=new CityData;i.name=this.otherCity[e],i.isselect=!1,this.allCity.push(i)}},t.getBgWidth=function(){return 0==t.bgWidth&&(t.bgWidth=egret.MainContext.instance.stage.stageWidth),t.bgWidth},t.getBgHeight=function(){return 0==t.bgHeight&&(t.bgHeight=egret.MainContext.instance.stage.stageHeight),t.bgHeight},t.getScore=function(){return t.score},t.setScore=function(e){t.score=e},t.setTime=function(e){t.time=e,t.time<0&&(t.time=0)},t.getTime=function(){return t.time},t.bgWidth=0,t.bgHeight=0,t.init_score=0,t.init_time=40,t.score=0,t.time=0,t.movebgW=2400,t.movebgH=420,t.mycitynum=16,t.cityspritew=120,t.cityspriteh=84,t.row=5,t.colu=20,t}();egret.registerClass(GameData,"GameData");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.onAddToStage=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},p.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},p.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},p.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},p.createGameScene=function(){var t=new GameBg;this.addChild(t),this.url="http://www.baoguangguang.cn/wxgame?url="+encodeURIComponent(location.href.split("#")[0]),this.getSignPackage()},p.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},p.startAnimation=function(t){for(var e=this,i=new egret.HtmlTextParser,h=[],s=0;s<t.length;s++)h.push(i.parser(t[s]));var a=e.textfield,r=-1,o=function(){r++,r>=h.length&&(r=0);var t=h[r];e.changeDescription(a,t);var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,e)};o()},p.changeDescription=function(t,e){t.textFlow=e},p.touchHandler=function(t){var e=t.currentTarget;e.textColor=65280},p.getSignPackage=function(){var t=this,e=new egret.URLLoader,i=new egret.URLRequest(this.url);e.load(i),i.method=egret.URLRequestMethod.GET,e.addEventListener(egret.Event.COMPLETE,function(e){t.signPackage=JSON.parse(e.target.data),t.getWeiXinConfig()},this)},p.getWeiXinConfig=function(){var t=new BodyConfig;t.debug=!1,t.appId=this.signPackage.appId,t.timestamp=this.signPackage.timestamp,t.nonceStr=this.signPackage.nonceStr,t.signature=this.signPackage.signature,t.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"],wx.config(t),wx.ready(function(){wx.checkJsApi({jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"],success:function(){}})}),wx.error(function(){}),this.goShare()},p.goShare=function(){var t="身为庆安人，对自己的家乡不熟悉怎么行那，快来测测自己对家乡到底有多了解，不是庆安人的还真玩不了!",e="http://mp.weixin.qq.com/s?__biz=MzA5MTQ2NjQ2MA==&mid=400311667&idx=1&sn=d68d97fd5da33a04fb39995981980671#rd",i=location.href.split("#")[0]+"logo32.png",h=new BodyMenuShareTimeline;h.title=t,h.link=e,h.imgUrl=i,h.trigger=function(){console.log("用户点击分享到朋友圈")},h.success=function(){console.log("已分享")},h.cancel=function(){console.log("已取消")},h.fail=function(t){console.log(JSON.stringify(t))},wx.onMenuShareTimeline(h);var s=new BodyMenuShareAppMessage;s.title=t,s.link=e,s.imgUrl=i,wx.onMenuShareAppMessage(s);var a=new BodyMenuShareQQ;a.title=t,a.link=e,a.imgUrl=i,wx.onMenuShareQQ(a);var r=new BodyMenuShareWeibo;r.title=t,r.link=e,r.imgUrl=i,wx.onMenuShareWeibo(r)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MoveBg=function(t){function e(){t.call(this),this.initData()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.initData=function(){this.y=60,this.width=GameData.movebgW,this.height=GameData.movebgH,this.graphics.beginFill(13883348),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touch,this),e.gameState=1,this.startBg=new egret.Sprite,this.startBg.width=GameData.getBgWidth(),this.startBg.height=GameData.movebgH,this.addChild(this.startBg);var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,this.startBg.width,this.startBg.height),t.graphics.endFill(),this.startBg.addChild(t);var i=new egret.TextField;i.textAlign=egret.HorizontalAlign.CENTER,i.text="身为庆安人，对自己的家乡不熟悉怎么行那，快来测测自己对家乡到底有多了解，尽可能在规定的时间找出属于庆安的乡镇。",i.width=GameData.getBgWidth()-20,i.x=(GameData.getBgWidth()-i.width)/2,i.y=100,i.size=25,this.startBg.addChild(i);var h=new egret.TextField;h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.background=!0,h.backgroundColor=16777215,h.border=!0,h.borderColor=0,h.fontFamily="Arial",h.textColor=0,h.size=30,h.text="开始游戏",h.width=200,h.height=80,h.x=(GameData.getBgWidth()-h.width)/2,h.y=220,this.startBg.addChild(h),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikSatrt,this)},p.touch=function(t){if(2==e.gameState)switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.startx=t.stageX,this.starty=t.stageY;break;case egret.TouchEvent.TOUCH_MOVE:this.movex=t.stageX-this.startx,this.movey=t.stageY-this.starty,this.x+=this.movex,this.x>0&&(this.x=0),this.x<GameData.getBgWidth()-this.width&&(this.x=GameData.getBgWidth()-this.width);break;case egret.TouchEvent.TOUCH_END:this.startx=t.stageX,this.starty=t.stageY}},p.random=function(t,e){return Math.floor(t+Math.random()*(e-t))},p.timerFunc=function(){if(GameData.setTime(GameData.getTime()-1),0==GameData.getTime())return void this.endGame();GameBg.setTime();var t=RES.getRes("s_time");t.play(0,1)},p.onclikSatrt=function(){var t=RES.getRes("s_click");t.play(0,1),this.removeChild(this.startBg),this.statrtGame()},p.onclikEnd=function(){var t=RES.getRes("s_click");t.play(0,1),this.removeChild(this.endBg),this.statrtGame()},p.goShare=function(){var t="";GameData.getScore()<3?t="被认为不确定是庆安人么！":GameData.getScore()<6?t="被认为好多地方还不熟悉啊!":GameData.getScore()<10?t="被认为知道的庆安地方还真多!":GameData.getScore()<14?t="被认为是地地道道的庆安人！":GameData.getScore()<=16&&(t="被认为是庆安的活地图");var e="我在"+(GameData.init_time-GameData.getTime())+"秒内找到了"+GameData.getScore()+"个乡镇,"+t+"身为庆安人你要不要也来试试？不是庆安人的还真玩不了!",i="http://mp.weixin.qq.com/s?__biz=MzA5MTQ2NjQ2MA==&mid=400311667&idx=1&sn=d68d97fd5da33a04fb39995981980671#rd",h=location.href.split("#")[0]+"logo32.png",s=new BodyMenuShareTimeline;s.title=e,s.link=i,s.imgUrl=h,s.trigger=function(){console.log("用户点击分享到朋友圈")},s.success=function(){console.log("已分享")},s.cancel=function(){console.log("已取消")},s.fail=function(t){console.log(JSON.stringify(t))},wx.onMenuShareTimeline(s);var a=new BodyMenuShareAppMessage;a.title=e,a.link=i,a.imgUrl=h,wx.onMenuShareAppMessage(a);var r=new BodyMenuShareQQ;r.title=e,r.link=i,r.imgUrl=h,wx.onMenuShareQQ(r);var o=new BodyMenuShareWeibo;o.title=e,o.link=i,o.imgUrl=h,wx.onMenuShareWeibo(o)},p.statrtGame=function(){GameData.setScore(GameData.init_score),GameData.setTime(GameData.init_time),GameBg.setScore(),GameBg.setTime(),e.gameState=2,this.x=0,this.data=new GameData,egret.log("this.data.allCity.length:",this.data.allCity.length);for(var t=0;t<GameData.colu;t++)for(var i=0;i<GameData.row;i++){var h=this.random(0,this.data.allCity.length),s=this.data.allCity[h];this.data.allCity.splice(h,1);var a=new CitySprite;a.setPost(t,i,s,this),this.addChild(a)}this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start()},p.endGame=function(){var t=RES.getRes("s_dialog");t.play(0,1),e.gameState=3,this.timer.stop(),this.endBg=new egret.Sprite,this.endBg.width=GameData.getBgWidth(),this.endBg.height=GameData.movebgH,this.endBg.x=-this.x,this.addChild(this.endBg);var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,this.endBg.width,this.endBg.height),i.graphics.endFill(),this.endBg.addChild(i);var h=new egret.TextField;h.textAlign=egret.HorizontalAlign.CENTER;var s="";GameData.getScore()<2?s="确定是庆安人么！":GameData.getScore()<6?s="庆安好多地方你还不熟悉啊！":GameData.getScore()<10?s="知道的地方还真多！":GameData.getScore()<14?s="真是一个地地道道的庆安人！":GameData.getScore()<=16&&(s="简直就是庆安的活地图！");var a="身为庆安人你在"+(GameData.init_time-GameData.getTime())+"秒内找到了"+GameData.getScore()+"个乡镇,"+s+"你可以分享给朋友们，看看他们的表现，不是庆安人的还真玩不了!";h.text=a,h.width=GameData.getBgWidth()-20,h.size=25,h.x=(GameData.getBgWidth()-h.width)/2,h.y=100,this.endBg.addChild(h);var r=new egret.TextField;r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.background=!0,r.backgroundColor=16777215,r.border=!0,r.borderColor=0,r.fontFamily="Arial",r.textColor=0,r.size=30,r.text="重新开始",r.width=200,r.height=80,r.x=(GameData.getBgWidth()-r.width)/2,r.y=220,this.endBg.addChild(r),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikEnd,this),this.goShare()},e.gameState=0,e}(egret.Sprite);egret.registerClass(MoveBg,"MoveBg");